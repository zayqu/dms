{"ast":null,"code":"// dms/client/src/components/SellerSaleForm.jsx\nimport React,{forwardRef,useImperativeHandle}from'react';import apiClient from'../services/api';import{enqueue,startQueueProcessor,getQueue}from'../utils/syncQueue';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SellerSaleForm=/*#__PURE__*/forwardRef(function SellerSaleForm(props,ref){const{onSaved}=props;const[items,setItems]=React.useState([]);const[paymentMethod,setPaymentMethod]=React.useState('Mpesa');const[queuedCount,setQueuedCount]=React.useState(0);useImperativeHandle(ref,()=>({addLine:product=>addLine(product)}));React.useEffect(()=>{startQueueProcessor({intervalMs:60000});const t=setInterval(async()=>{const q=await getQueue();setQueuedCount(q.length);},1500);(async()=>{const q=await getQueue();setQueuedCount(q.length);})();return()=>clearInterval(t);},[]);const addLine=product=>setItems(prev=>[...prev,{productId:product._id,name:product.name,qty:1,unitPrice:product.sellPrice}]);const updateLine=(i,key,val)=>{const copy=items.slice();copy[i][key]=key==='qty'||key==='unitPrice'?Number(val):val;setItems(copy);};const removeLine=i=>setItems(items.filter((_,idx)=>idx!==i));const submit=async()=>{if(items.length===0)return alert('Add items');const payload={type:'sale',items:items.map(it=>({productId:it.productId,qty:it.qty,unitPrice:it.unitPrice})),paymentMethod};try{await apiClient.api('/api/transactions',{method:'POST',body:JSON.stringify(payload),headers:{'Content-Type':'application/json'}});setItems([]);const q=await getQueue();setQueuedCount(q.length);if(onSaved)onSaved();alert('Sale recorded');}catch(err){console.warn('Save failed, enqueueing',err&&err.message?err.message:err);try{await enqueue('transaction',payload);const q=await getQueue();setQueuedCount(q.length);setItems([]);alert('You are offline — sale saved locally and will sync when online.');startQueueProcessor();}catch(enqErr){console.error('enqueue failed',enqErr);alert('Failed to save sale. Try again.');}}};const total=items.reduce((s,i)=>s+i.qty*i.unitPrice,0);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginBottom:8},children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Sale\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:queuedCount?'#c0392b':'#0b6'},children:queuedCount?\"\".concat(queuedCount,\" queued\"):'All synced'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Payment\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"input\",value:paymentMethod,onChange:e=>setPaymentMethod(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{children:\"Mpesa\"}),/*#__PURE__*/_jsx(\"option\",{children:\"AirtelMoney\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Cash\"}),/*#__PURE__*/_jsx(\"option\",{children:\"Bank\"})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:items.map((it,i)=>/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,marginBottom:6},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700},children:it.name})}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",style:{width:80},type:\"number\",value:it.qty,onChange:e=>updateLine(i,'qty',e.target.value)}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",style:{width:100},type:\"number\",value:it.unitPrice,onChange:e=>updateLine(i,'unitPrice',e.target.value)}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:()=>removeLine(i),children:\"X\"})]},i))}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:8},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700},children:[\"Total: \",total,\" TZS\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",onClick:submit,children:\"Complete Sale\"})]})]})]});});export default SellerSaleForm;","map":{"version":3,"names":["React","forwardRef","useImperativeHandle","apiClient","enqueue","startQueueProcessor","getQueue","jsx","_jsx","jsxs","_jsxs","SellerSaleForm","props","ref","onSaved","items","setItems","useState","paymentMethod","setPaymentMethod","queuedCount","setQueuedCount","addLine","product","useEffect","intervalMs","t","setInterval","q","length","clearInterval","prev","productId","_id","name","qty","unitPrice","sellPrice","updateLine","i","key","val","copy","slice","Number","removeLine","filter","_","idx","submit","alert","payload","type","map","it","api","method","body","JSON","stringify","headers","err","console","warn","message","enqErr","error","total","reduce","s","children","style","display","justifyContent","marginBottom","fontSize","color","concat","className","value","onChange","e","target","marginTop","gap","flex","fontWeight","width","onClick","alignItems"],"sources":["E:/Creative/App/dms/client/src/components/SellerSaleForm.jsx"],"sourcesContent":["// dms/client/src/components/SellerSaleForm.jsx\r\nimport React, { forwardRef, useImperativeHandle } from 'react';\r\nimport apiClient from '../services/api';\r\nimport { enqueue, startQueueProcessor, getQueue } from '../utils/syncQueue';\r\n\r\nconst SellerSaleForm = forwardRef(function SellerSaleForm(props, ref) {\r\n  const { onSaved } = props;\r\n  const [items, setItems] = React.useState([]);\r\n  const [paymentMethod, setPaymentMethod] = React.useState('Mpesa');\r\n  const [queuedCount, setQueuedCount] = React.useState(0);\r\n\r\n  useImperativeHandle(ref, () => ({ addLine: (product) => addLine(product) }));\r\n\r\n  React.useEffect(() => {\r\n    startQueueProcessor({ intervalMs: 60_000 });\r\n    const t = setInterval(async () => { const q = await getQueue(); setQueuedCount(q.length); }, 1500);\r\n    (async ()=>{ const q = await getQueue(); setQueuedCount(q.length); })();\r\n    return () => clearInterval(t);\r\n  }, []);\r\n\r\n  const addLine = (product) => setItems(prev => [...prev, { productId: product._id, name: product.name, qty: 1, unitPrice: product.sellPrice }]);\r\n\r\n  const updateLine = (i, key, val) => {\r\n    const copy = items.slice();\r\n    copy[i][key] = (key === 'qty' || key === 'unitPrice') ? Number(val) : val;\r\n    setItems(copy);\r\n  };\r\n\r\n  const removeLine = (i) => setItems(items.filter((_, idx) => idx !== i));\r\n\r\n  const submit = async () => {\r\n    if (items.length === 0) return alert('Add items');\r\n    const payload = {\r\n      type: 'sale',\r\n      items: items.map(it => ({ productId: it.productId, qty: it.qty, unitPrice: it.unitPrice })),\r\n      paymentMethod\r\n    };\r\n\r\n    try {\r\n      await apiClient.api('/api/transactions', { method: 'POST', body: JSON.stringify(payload), headers: { 'Content-Type': 'application/json' } });\r\n      setItems([]);\r\n      const q = await getQueue(); setQueuedCount(q.length);\r\n      if (onSaved) onSaved();\r\n      alert('Sale recorded');\r\n    } catch (err) {\r\n      console.warn('Save failed, enqueueing', err && err.message ? err.message : err);\r\n      try {\r\n        await enqueue('transaction', payload);\r\n        const q = await getQueue(); setQueuedCount(q.length);\r\n        setItems([]);\r\n        alert('You are offline — sale saved locally and will sync when online.');\r\n        startQueueProcessor();\r\n      } catch (enqErr) {\r\n        console.error('enqueue failed', enqErr);\r\n        alert('Failed to save sale. Try again.');\r\n      }\r\n    }\r\n  };\r\n\r\n  const total = items.reduce((s, i) => s + (i.qty * i.unitPrice), 0);\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: 8 }}>\r\n        <h4>Sale</h4>\r\n        <div style={{ fontSize: 13, color: queuedCount ? '#c0392b' : '#0b6' }}>\r\n          {queuedCount ? `${queuedCount} queued` : 'All synced'}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"card\">\r\n        <div>\r\n          <label>Payment</label>\r\n          <select className=\"input\" value={paymentMethod} onChange={e => setPaymentMethod(e.target.value)}>\r\n            <option>Mpesa</option><option>AirtelMoney</option><option>Cash</option><option>Bank</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div style={{ marginTop: 8 }}>\r\n          {items.map((it, i) => (\r\n            <div key={i} style={{ display: 'flex', gap: 8, marginBottom: 6 }}>\r\n              <div style={{ flex: 1 }}>\r\n                <div style={{ fontWeight: 700 }}>{it.name}</div>\r\n              </div>\r\n              <input className=\"input\" style={{ width: 80 }} type=\"number\" value={it.qty} onChange={e => updateLine(i, 'qty', e.target.value)} />\r\n              <input className=\"input\" style={{ width: 100 }} type=\"number\" value={it.unitPrice} onChange={e => updateLine(i, 'unitPrice', e.target.value)} />\r\n              <button className=\"btn\" onClick={() => removeLine(i)}>X</button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginTop: 8 }}>\r\n          <div style={{ fontWeight: 700 }}>Total: {total} TZS</div>\r\n          <button className=\"btn\" onClick={submit}>Complete Sale</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\nexport default SellerSaleForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}